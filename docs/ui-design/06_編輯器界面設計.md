# BandPro ç·¨è¼¯å™¨ç•Œé¢è¨­è¨ˆ

å°ˆæ¥­éŸ³æ¨‚ç·¨è¼¯å™¨çš„å®Œæ•´ç•Œé¢è¨­è¨ˆè¦ç¯„

## ğŸ¼ ç·¨è¼¯å™¨æ ¸å¿ƒæ¶æ§‹

### ç·¨è¼¯å™¨ç•Œé¢å±¤æ¬¡
```mermaid
flowchart TD
    subgraph EditorInterface[ç·¨è¼¯å™¨ç•Œé¢å±¤æ¬¡]
        subgraph Layer1[å·¥å…·å±¤]
            ToolPalette[å·¥å…·é¸ç›¤<br/>éŸ³ç¬¦/ä¼‘æ­¢ç¬¦/ç¬¦è™Ÿ]
            ContextualTools[æƒ…å¢ƒå·¥å…·<br/>æ ¹æ“šé¸å–å…§å®¹]
        end
        
        subgraph Layer2[ç•«å¸ƒå±¤]
            ScoreCanvas[æ¨‚è­œç•«å¸ƒ<br/>ä¸»è¦ç·¨è¼¯å€åŸŸ]
            StaffSystem[äº”ç·šè­œç³»çµ±<br/>å¤šéŸ³è»Œé¡¯ç¤º]
            PlaybackCursor[æ’­æ”¾æ¸¸æ¨™<br/>å³æ™‚ä½ç½®æŒ‡ç¤º]
        end
        
        subgraph Layer3[è¼”åŠ©å±¤]
            GridSystem[ç¶²æ ¼ç³»çµ±<br/>å°é½Šè¼”åŠ©ç·š]
            SelectionOverlay[é¸å–è¦†è“‹å±¤<br/>é¸å–ç‹€æ…‹é¡¯ç¤º]
            CollaborationCursors[å”ä½œæ¸¸æ¨™<br/>å…¶ä»–ç”¨æˆ¶ä½ç½®]
        end
        
        subgraph Layer4[äº’å‹•å±¤]
            DragHandles[æ‹–æ‹½æ§åˆ¶é»<br/>èª¿æ•´å¤§å°/ä½ç½®]
            HoverTooltips[æ‡¸æµ®æç¤º<br/>å…ƒç´ è³‡è¨Š]
            ContextMenus[å³éµé¸å–®<br/>å¿«é€Ÿæ“ä½œ]
        end
    end
    
    ToolPalette --> ScoreCanvas
    ContextualTools --> StaffSystem
    ScoreCanvas --> GridSystem
    StaffSystem --> SelectionOverlay
    PlaybackCursor --> CollaborationCursors
    
    GridSystem --> DragHandles
    SelectionOverlay --> HoverTooltips
    CollaborationCursors --> ContextMenus
```

### éŸ³æ¨‚å…ƒç´ çµ„ç¹”æ¶æ§‹
```mermaid
mindmap
  root((éŸ³æ¨‚å…ƒç´ ))
    éŸ³ç¬¦ç³»çµ±
      åŸºæœ¬éŸ³ç¬¦
        å…¨éŸ³ç¬¦
        äºŒåˆ†éŸ³ç¬¦
        å››åˆ†éŸ³ç¬¦
        å…«åˆ†éŸ³ç¬¦
        åå…­åˆ†éŸ³ç¬¦
      è£é£¾éŸ³ç¬¦
        å€šéŸ³
        é¡«éŸ³
        æ»‘éŸ³
      ç‰¹æ®ŠéŸ³ç¬¦
        æ³›éŸ³
        é›œéŸ³
        æ‰“æ“ŠéŸ³ç¬¦
    ä¼‘æ­¢ç¬¦ç³»çµ±
      å…¨ä¼‘æ­¢ç¬¦
      äºŒåˆ†ä¼‘æ­¢ç¬¦
      å››åˆ†ä¼‘æ­¢ç¬¦
      å…«åˆ†ä¼‘æ­¢ç¬¦
      åå…­åˆ†ä¼‘æ­¢ç¬¦
    ç¬¦è™Ÿç³»çµ±
      èª¿è™Ÿ
        å‡è™Ÿ
        é™è™Ÿ
        é‚„åŸè™Ÿ
      è¡¨æƒ…è¨˜è™Ÿ
        å¼·å¼±è¨˜è™Ÿ
        é€Ÿåº¦è¨˜è™Ÿ
        è¡¨æƒ…æ¨™è¨˜
      é€£æ¥ç¬¦è™Ÿ
        é€£éŸ³ç·š
        å»¶éŸ³ç·š
        åœ“æ»‘ç·š
```

---

## ğŸ¨ å·¥å…·é¢æ¿è¨­è¨ˆ

### ä¸»è¦å·¥å…·é¸ç›¤
```vue
<!-- components/editor/ToolPalette.vue -->
<template>
  <div class="tool-palette">
    <!-- å·¥å…·åˆ†é¡æ¨™ç±¤ -->
    <div class="tool-categories">
      <button
        v-for="category in toolCategories"
        :key="category.id"
        @click="activeCategory = category.id"
        class="category-tab"
        :class="{ 'tab-active': activeCategory === category.id }"
        :title="category.tooltip"
      >
        <component :is="category.icon" class="w-5 h-5" />
        <span class="category-label">{{ category.name }}</span>
      </button>
    </div>
    
    <!-- å·¥å…·ç¶²æ ¼ -->
    <div class="tools-grid">
      <div
        v-for="tool in currentTools"
        :key="tool.id"
        @click="selectTool(tool)"
        @mouseenter="showToolPreview(tool)"
        @mouseleave="hideToolPreview"
        class="tool-item"
        :class="{ 
          'tool-active': selectedTool?.id === tool.id,
          'tool-disabled': tool.disabled
        }"
        :title="tool.tooltip"
      >
        <!-- å·¥å…·åœ–æ¨™ -->
        <div class="tool-icon">
          <component 
            v-if="tool.iconComponent"
            :is="tool.iconComponent" 
            class="w-6 h-6"
          />
          <div 
            v-else-if="tool.symbol"
            class="tool-symbol"
          >
            {{ tool.symbol }}
          </div>
          <img 
            v-else-if="tool.image"
            :src="tool.image" 
            :alt="tool.name"
            class="tool-image"
          />
        </div>
        
        <!-- å·¥å…·åç¨± -->
        <div class="tool-name">{{ tool.name }}</div>
        
        <!-- å¿«æ·éµ -->
        <div v-if="tool.shortcut" class="tool-shortcut">
          {{ tool.shortcut }}
        </div>
      </div>
    </div>
    
    <!-- å·¥å…·é è¦½ -->
    <div v-if="previewTool" class="tool-preview">
      <div class="preview-content">
        <h4 class="preview-title">{{ previewTool.name }}</h4>
        <p class="preview-description">{{ previewTool.description }}</p>
        <div v-if="previewTool.shortcut" class="preview-shortcut">
          å¿«æ·éµ: <kbd>{{ previewTool.shortcut }}</kbd>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed } from 'vue'
import {
  MusicalNoteIcon,
  PauseIcon,
  HashtagIcon,
  SpeakerWaveIcon
} from '@heroicons/vue/24/outline'

interface Tool {
  id: string
  name: string
  category: string
  iconComponent?: any
  symbol?: string
  image?: string
  shortcut?: string
  tooltip: string
  description: string
  disabled?: boolean
}

const activeCategory = ref('notes')
const selectedTool = ref<Tool | null>(null)
const previewTool = ref<Tool | null>(null)

const toolCategories = [
  {
    id: 'notes',
    name: 'éŸ³ç¬¦',
    icon: MusicalNoteIcon,
    tooltip: 'éŸ³ç¬¦å·¥å…·'
  },
  {
    id: 'rests',
    name: 'ä¼‘æ­¢ç¬¦',
    icon: PauseIcon,
    tooltip: 'ä¼‘æ­¢ç¬¦å·¥å…·'
  },
  {
    id: 'symbols',
    name: 'ç¬¦è™Ÿ',
    icon: HashtagIcon,
    tooltip: 'éŸ³æ¨‚ç¬¦è™Ÿ'
  },
  {
    id: 'dynamics',
    name: 'è¡¨æƒ…',
    icon: SpeakerWaveIcon,
    tooltip: 'è¡¨æƒ…è¨˜è™Ÿ'
  }
]

const allTools: Tool[] = [
  // éŸ³ç¬¦å·¥å…·
  {
    id: 'whole-note',
    name: 'å…¨éŸ³ç¬¦',
    category: 'notes',
    symbol: 'ğ…',
    shortcut: '1',
    tooltip: 'å…¨éŸ³ç¬¦ (1)',
    description: 'æŒçºŒå››æ‹çš„éŸ³ç¬¦'
  },
  {
    id: 'half-note',
    name: 'äºŒåˆ†éŸ³ç¬¦',
    category: 'notes',
    symbol: 'ğ…—ğ…¥',
    shortcut: '2',
    tooltip: 'äºŒåˆ†éŸ³ç¬¦ (2)',
    description: 'æŒçºŒå…©æ‹çš„éŸ³ç¬¦'
  },
  {
    id: 'quarter-note',
    name: 'å››åˆ†éŸ³ç¬¦',
    category: 'notes',
    symbol: 'â™©',
    shortcut: '4',
    tooltip: 'å››åˆ†éŸ³ç¬¦ (4)',
    description: 'æŒçºŒä¸€æ‹çš„éŸ³ç¬¦'
  },
  {
    id: 'eighth-note',
    name: 'å…«åˆ†éŸ³ç¬¦',
    category: 'notes',
    symbol: 'â™ª',
    shortcut: '8',
    tooltip: 'å…«åˆ†éŸ³ç¬¦ (8)',
    description: 'æŒçºŒåŠæ‹çš„éŸ³ç¬¦'
  },
  {
    id: 'sixteenth-note',
    name: 'åå…­åˆ†éŸ³ç¬¦',
    category: 'notes',
    symbol: 'ğ…˜ğ…¥ğ…¯',
    shortcut: '6',
    tooltip: 'åå…­åˆ†éŸ³ç¬¦ (6)',
    description: 'æŒçºŒå››åˆ†ä¹‹ä¸€æ‹çš„éŸ³ç¬¦'
  },
  
  // ä¼‘æ­¢ç¬¦å·¥å…·
  {
    id: 'whole-rest',
    name: 'å…¨ä¼‘æ­¢ç¬¦',
    category: 'rests',
    symbol: 'â– ',
    shortcut: 'Shift+1',
    tooltip: 'å…¨ä¼‘æ­¢ç¬¦ (Shift+1)',
    description: 'æŒçºŒå››æ‹çš„ä¼‘æ­¢ç¬¦'
  },
  {
    id: 'half-rest',
    name: 'äºŒåˆ†ä¼‘æ­¢ç¬¦',
    category: 'rests',
    symbol: 'â– ',
    shortcut: 'Shift+2',
    tooltip: 'äºŒåˆ†ä¼‘æ­¢ç¬¦ (Shift+2)',
    description: 'æŒçºŒå…©æ‹çš„ä¼‘æ­¢ç¬¦'
  },
  {
    id: 'quarter-rest',
    name: 'å››åˆ†ä¼‘æ­¢ç¬¦',
    category: 'rests',
    symbol: 'ğ„½',
    shortcut: 'Shift+4',
    tooltip: 'å››åˆ†ä¼‘æ­¢ç¬¦ (Shift+4)',
    description: 'æŒçºŒä¸€æ‹çš„ä¼‘æ­¢ç¬¦'
  },
  
  // ç¬¦è™Ÿå·¥å…·
  {
    id: 'sharp',
    name: 'å‡è™Ÿ',
    category: 'symbols',
    symbol: 'â™¯',
    shortcut: 'S',
    tooltip: 'å‡è™Ÿ (S)',
    description: 'å‡é«˜åŠéŸ³çš„è¨˜è™Ÿ'
  },
  {
    id: 'flat',
    name: 'é™è™Ÿ',
    category: 'symbols',
    symbol: 'â™­',
    shortcut: 'F',
    tooltip: 'é™è™Ÿ (F)',
    description: 'é™ä½åŠéŸ³çš„è¨˜è™Ÿ'
  },
  {
    id: 'natural',
    name: 'é‚„åŸè™Ÿ',
    category: 'symbols',
    symbol: 'â™®',
    shortcut: 'N',
    tooltip: 'é‚„åŸè™Ÿ (N)',
    description: 'å–æ¶ˆå‡é™çš„è¨˜è™Ÿ'
  },
  
  // è¡¨æƒ…è¨˜è™Ÿ
  {
    id: 'forte',
    name: 'å¼· (f)',
    category: 'dynamics',
    symbol: 'f',
    shortcut: 'Alt+F',
    tooltip: 'å¼·éŸ³è¨˜è™Ÿ (Alt+F)',
    description: 'è¡¨ç¤ºéŸ³é‡å¼·åº¦'
  },
  {
    id: 'piano',
    name: 'å¼± (p)',
    category: 'dynamics',
    symbol: 'p',
    shortcut: 'Alt+P',
    tooltip: 'å¼±éŸ³è¨˜è™Ÿ (Alt+P)',
    description: 'è¡¨ç¤ºéŸ³é‡è¼•æŸ”'
  }
]

const currentTools = computed(() => {
  return allTools.filter(tool => tool.category === activeCategory.value)
})

const selectTool = (tool: Tool) => {
  if (tool.disabled) return
  selectedTool.value = tool
  // ç™¼é€å·¥å…·é¸æ“‡äº‹ä»¶
  console.log('Selected tool:', tool.id)
}

const showToolPreview = (tool: Tool) => {
  previewTool.value = tool
}

const hideToolPreview = () => {
  previewTool.value = null
}
</script>

<style scoped>
.tool-palette {
  @apply h-full flex flex-col;
  @apply bg-white dark:bg-gray-800;
}

/* å·¥å…·åˆ†é¡æ¨™ç±¤ */
.tool-categories {
  @apply flex border-b border-gray-200 dark:border-gray-700;
  @apply flex-shrink-0;
}

.category-tab {
  @apply flex-1 flex flex-col items-center justify-center;
  @apply py-3 px-2;
  @apply text-xs font-medium;
  @apply text-gray-600 dark:text-gray-400;
  @apply hover:text-gray-900 dark:hover:text-white;
  @apply hover:bg-gray-50 dark:hover:bg-gray-700;
  @apply border-b-2 border-transparent;
  @apply transition-all duration-200;
  
  &.tab-active {
    @apply text-blue-600 dark:text-blue-400;
    @apply border-blue-500 dark:border-blue-400;
    @apply bg-blue-50 dark:bg-blue-900/20;
  }
}

.category-label {
  @apply mt-1;
}

/* å·¥å…·ç¶²æ ¼ */
.tools-grid {
  @apply flex-1 overflow-y-auto;
  @apply p-2;
  @apply grid grid-cols-2 gap-2;
}

.tool-item {
  @apply relative flex flex-col items-center;
  @apply p-3 rounded-lg;
  @apply bg-gray-50 dark:bg-gray-700;
  @apply hover:bg-gray-100 dark:hover:bg-gray-600;
  @apply border-2 border-transparent;
  @apply cursor-pointer;
  @apply transition-all duration-200;
  
  &.tool-active {
    @apply bg-blue-100 dark:bg-blue-900/30;
    @apply border-blue-500 dark:border-blue-400;
  }
  
  &.tool-disabled {
    @apply opacity-50 cursor-not-allowed;
  }
}

.tool-icon {
  @apply mb-2 flex items-center justify-center;
  @apply w-8 h-8;
}

.tool-symbol {
  @apply text-2xl font-bold;
  @apply text-gray-700 dark:text-gray-300;
}

.tool-image {
  @apply w-full h-full object-contain;
}

.tool-name {
  @apply text-xs font-medium text-center;
  @apply text-gray-700 dark:text-gray-300;
  @apply mb-1;
}

.tool-shortcut {
  @apply text-xs text-gray-500 dark:text-gray-400;
  @apply bg-gray-200 dark:bg-gray-600;
  @apply px-1 rounded;
}

/* å·¥å…·é è¦½ */
.tool-preview {
  @apply border-t border-gray-200 dark:border-gray-700;
  @apply p-4 bg-gray-50 dark:bg-gray-700;
  @apply flex-shrink-0;
}

.preview-content {
  @apply space-y-2;
}

.preview-title {
  @apply font-semibold text-gray-900 dark:text-white;
}

.preview-description {
  @apply text-sm text-gray-600 dark:text-gray-300;
}

.preview-shortcut {
  @apply text-xs text-gray-500 dark:text-gray-400;
}

.preview-shortcut kbd {
  @apply bg-gray-200 dark:bg-gray-600;
  @apply px-1 py-0.5 rounded text-xs;
  @apply font-mono;
}
</style>
```

---

## ğŸ¼ æ¨‚è­œç•«å¸ƒè¨­è¨ˆ

### äº”ç·šè­œç•«å¸ƒæ¶æ§‹
```vue
<!-- components/editor/ScoreCanvas.vue -->
<template>
  <div 
    ref="canvasContainer"
    class="score-canvas-container"
    @wheel="handleZoom"
    @mousedown="handleCanvasMouseDown"
    @mousemove="handleCanvasMouseMove"
    @mouseup="handleCanvasMouseUp"
    @contextmenu="handleContextMenu"
  >
    <!-- SVG æ¨‚è­œç•«å¸ƒ -->
    <svg
      ref="scoreCanvas"
      class="score-canvas"
      :viewBox="`0 0 ${canvasWidth} ${canvasHeight}`"
      :style="{ 
        transform: `scale(${zoomLevel / 100})`,
        transformOrigin: 'top left'
      }"
    >
      <!-- èƒŒæ™¯ç¶²æ ¼ -->
      <g v-if="showGrid" class="grid-layer">
        <defs>
          <pattern
            id="grid"
            width="20"
            height="20"
            patternUnits="userSpaceOnUse"
          >
            <path
              d="M 20 0 L 0 0 0 20"
              fill="none"
              stroke="currentColor"
              stroke-width="0.5"
              opacity="0.3"
            />
          </pattern>
        </defs>
        <rect width="100%" height="100%" fill="url(#grid)" />
      </g>
      
      <!-- äº”ç·šè­œç³»çµ± -->
      <g class="staff-system-layer">
        <StaffSystem
          v-for="(system, index) in staffSystems"
          :key="`system-${index}`"
          :system="system"
          :y-position="index * staffSystemHeight"
          @note-click="handleNoteClick"
          @note-drag="handleNoteDrag"
        />
      </g>
      
      <!-- é¸å–è¦†è“‹å±¤ -->
      <g class="selection-layer">
        <SelectionBox
          v-if="selectionBox"
          :box="selectionBox"
        />
        <g v-for="element in selectedElements" :key="element.id">
          <SelectionHighlight :element="element" />
        </g>
      </g>
      
      <!-- æ’­æ”¾æ¸¸æ¨™ -->
      <g v-if="isPlaying" class="playback-layer">
        <PlaybackCursor
          :position="playbackPosition"
          :height="canvasHeight"
        />
      </g>
      
      <!-- å”ä½œæ¸¸æ¨™ -->
      <g class="collaboration-layer">
        <CollaborationCursor
          v-for="cursor in collaborationCursors"
          :key="cursor.userId"
          :cursor="cursor"
        />
      </g>
      
      <!-- æ‹–æ‹½é è¦½ -->
      <g v-if="dragPreview" class="drag-preview-layer">
        <DragPreview :preview="dragPreview" />
      </g>
    </svg>
    
    <!-- ç•«å¸ƒè¦†è“‹å±¤ -->
    <div class="canvas-overlay">
      <!-- ç¸®æ”¾æ§åˆ¶ -->
      <div class="zoom-controls">
        <div class="zoom-indicator">{{ Math.round(zoomLevel) }}%</div>
        <div class="zoom-slider">
          <input
            v-model="zoomLevel"
            type="range"
            min="25"
            max="400"
            step="25"
            class="zoom-range"
          />
        </div>
      </div>
      
      <!-- å°åœ°åœ–å°èˆª -->
      <div v-if="showMinimap" class="minimap">
        <MinimapView
          :canvas-width="canvasWidth"
          :canvas-height="canvasHeight"
          :viewport="viewport"
          @viewport-change="handleViewportChange"
        />
      </div>
      
      <!-- æƒ…å¢ƒå·¥å…·æ¬„ -->
      <ContextualToolbar
        v-if="contextualTools.length > 0"
        :tools="contextualTools"
        :position="contextualToolbarPosition"
        @tool-select="handleContextualTool"
      />
    </div>
    
    <!-- å³éµé¸å–® -->
    <ContextMenu
      v-if="contextMenu"
      :menu="contextMenu"
      :position="contextMenuPosition"
      @menu-select="handleContextMenuSelect"
      @menu-close="closeContextMenu"
    />
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted, onUnmounted } from 'vue'

interface Props {
  zoomLevel: number
  isPlaying: boolean
  showGrid?: boolean
  showMinimap?: boolean
}

const props = withDefaults(defineProps<Props>(), {
  showGrid: true,
  showMinimap: true
})

const emit = defineEmits<{
  'selection-change': [elements: any[]]
  'zoom-change': [level: number]
  'viewport-change': [viewport: any]
}>()

// ç•«å¸ƒç‹€æ…‹
const canvasContainer = ref<HTMLDivElement>()
const scoreCanvas = ref<SVGElement>()
const canvasWidth = ref(1200)
const canvasHeight = ref(800)
const staffSystemHeight = ref(120)

// äº’å‹•ç‹€æ…‹
const isDragging = ref(false)
const dragStart = ref({ x: 0, y: 0 })
const selectionBox = ref<any>(null)
const selectedElements = ref<any[]>([])
const contextMenu = ref<any>(null)
const contextMenuPosition = ref({ x: 0, y: 0 })
const dragPreview = ref<any>(null)

// æ’­æ”¾ç‹€æ…‹
const playbackPosition = ref(0)

// å”ä½œç‹€æ…‹
const collaborationCursors = ref<any[]>([])

// æƒ…å¢ƒå·¥å…·
const contextualTools = ref<any[]>([])
const contextualToolbarPosition = ref({ x: 0, y: 0 })

// è¦–çª—ç‹€æ…‹
const viewport = ref({
  x: 0,
  y: 0,
  width: 1200,
  height: 800
})

// äº”ç·šè­œç³»çµ±
const staffSystems = computed(() => {
  // ç”Ÿæˆäº”ç·šè­œç³»çµ±è³‡æ–™
  return [
    {
      id: 'system-1',
      staves: [
        { clef: 'treble', key: 'C', time: '4/4' }
      ],
      measures: []
    }
  ]
})

// äº‹ä»¶è™•ç†
const handleZoom = (event: WheelEvent) => {
  event.preventDefault()
  const delta = event.deltaY > 0 ? -10 : 10
  const newZoom = Math.max(25, Math.min(400, props.zoomLevel + delta))
  emit('zoom-change', newZoom)
}

const handleCanvasMouseDown = (event: MouseEvent) => {
  if (event.button === 0) { // å·¦éµ
    isDragging.value = true
    dragStart.value = { x: event.clientX, y: event.clientY }
    
    // é–‹å§‹é¸å–æ¡†
    selectionBox.value = {
      x: event.offsetX,
      y: event.offsetY,
      width: 0,
      height: 0
    }
  }
}

const handleCanvasMouseMove = (event: MouseEvent) => {
  if (isDragging.value && selectionBox.value) {
    // æ›´æ–°é¸å–æ¡†
    selectionBox.value.width = event.offsetX - selectionBox.value.x
    selectionBox.value.height = event.offsetY - selectionBox.value.y
  }
}

const handleCanvasMouseUp = () => {
  if (isDragging.value) {
    isDragging.value = false
    
    // å®Œæˆé¸å–
    if (selectionBox.value) {
      const elements = getElementsInBox(selectionBox.value)
      selectedElements.value = elements
      emit('selection-change', elements)
      selectionBox.value = null
    }
  }
}

const handleContextMenu = (event: MouseEvent) => {
  event.preventDefault()
  contextMenu.value = generateContextMenu(event.target)
  contextMenuPosition.value = { x: event.clientX, y: event.clientY }
}

const handleNoteClick = (note: any) => {
  selectedElements.value = [note]
  emit('selection-change', [note])
  
  // é¡¯ç¤ºæƒ…å¢ƒå·¥å…·
  contextualTools.value = generateContextualTools(note)
  contextualToolbarPosition.value = {
    x: note.x + 50,
    y: note.y - 40
  }
}

const handleNoteDrag = (note: any, position: any) => {
  // è™•ç†éŸ³ç¬¦æ‹–æ‹½
  console.log('Note dragged:', note, position)
}

const handleContextualTool = (tool: any) => {
  console.log('Contextual tool selected:', tool)
}

const handleViewportChange = (newViewport: any) => {
  viewport.value = newViewport
  emit('viewport-change', newViewport)
}

const closeContextMenu = () => {
  contextMenu.value = null
}

const handleContextMenuSelect = (action: string) => {
  console.log('Context menu action:', action)
  closeContextMenu()
}

const getElementsInBox = (box: any) => {
  // è¿”å›é¸å–æ¡†å…§çš„å…ƒç´ 
  return []
}

const generateContextMenu = (target: any) => {
  // æ ¹æ“šç›®æ¨™ç”Ÿæˆæƒ…å¢ƒé¸å–®
  return {
    items: [
      { label: 'è¤‡è£½', action: 'copy' },
      { label: 'å‰ªä¸‹', action: 'cut' },
      { label: 'è²¼ä¸Š', action: 'paste' },
      { separator: true },
      { label: 'åˆªé™¤', action: 'delete' }
    ]
  }
}

const generateContextualTools = (element: any) => {
  // æ ¹æ“šå…ƒç´ ç”Ÿæˆæƒ…å¢ƒå·¥å…·
  return [
    { id: 'pitch-up', label: 'å‡é«˜', icon: 'arrow-up' },
    { id: 'pitch-down', label: 'é™ä½', icon: 'arrow-down' },
    { id: 'duration-longer', label: 'å»¶é•·', icon: 'plus' },
    { id: 'duration-shorter', label: 'ç¸®çŸ­', icon: 'minus' }
  ]
}

onMounted(() => {
  // ç›£è½éµç›¤äº‹ä»¶
  document.addEventListener('keydown', handleKeyDown)
  document.addEventListener('keyup', handleKeyUp)
})

onUnmounted(() => {
  document.removeEventListener('keydown', handleKeyDown)
  document.removeEventListener('keyup', handleKeyUp)
})

const handleKeyDown = (event: KeyboardEvent) => {
  // è™•ç†éµç›¤å¿«æ·éµ
  switch (event.key) {
    case 'Delete':
      deleteSelectedElements()
      break
    case 'Escape':
      clearSelection()
      break
  }
}

const handleKeyUp = (event: KeyboardEvent) => {
  // è™•ç†éµç›¤é‡‹æ”¾äº‹ä»¶
}

const deleteSelectedElements = () => {
  selectedElements.value = []
  emit('selection-change', [])
}

const clearSelection = () => {
  selectedElements.value = []
  contextualTools.value = []
  emit('selection-change', [])
}
</script>

<style scoped>
.score-canvas-container {
  @apply relative w-full h-full overflow-hidden;
  @apply bg-white dark:bg-gray-900;
}

.score-canvas {
  @apply w-full h-full;
  @apply cursor-default;
  color: theme('colors.gray.800');
  
  .dark & {
    color: theme('colors.gray.200');
  }
}

.grid-layer {
  @apply pointer-events-none;
}

.staff-system-layer {
  @apply pointer-events-auto;
}

.selection-layer {
  @apply pointer-events-none;
}

.playback-layer {
  @apply pointer-events-none;
}

.collaboration-layer {
  @apply pointer-events-none;
}

.drag-preview-layer {
  @apply pointer-events-none;
}

/* ç•«å¸ƒè¦†è“‹å±¤ */
.canvas-overlay {
  @apply absolute inset-0 pointer-events-none;
}

.zoom-controls {
  @apply absolute bottom-4 right-4;
  @apply pointer-events-auto;
  @apply bg-white dark:bg-gray-800;
  @apply rounded-lg shadow-lg;
  @apply p-3 space-y-2;
}

.zoom-indicator {
  @apply text-sm font-medium text-center;
  @apply text-gray-700 dark:text-gray-300;
}

.zoom-slider {
  @apply w-32;
}

.zoom-range {
  @apply w-full h-2;
  @apply bg-gray-200 dark:bg-gray-600;
  @apply rounded-lg appearance-none;
  @apply cursor-pointer;
  
  &::-webkit-slider-thumb {
    @apply appearance-none w-4 h-4;
    @apply bg-blue-500 rounded-full;
    @apply cursor-pointer;
  }
  
  &::-moz-range-thumb {
    @apply w-4 h-4 bg-blue-500;
    @apply border-0 rounded-full;
    @apply cursor-pointer;
  }
}

.minimap {
  @apply absolute top-4 right-4;
  @apply pointer-events-auto;
  @apply w-48 h-32;
  @apply bg-white dark:bg-gray-800;
  @apply border border-gray-300 dark:border-gray-600;
  @apply rounded-lg shadow-lg;
}
</style>
```

---

## ğŸµ éŸ³ç¬¦ç·¨è¼¯çµ„ä»¶

### æ™ºèƒ½éŸ³ç¬¦è¼¸å…¥
```vue
<!-- components/editor/NoteInput.vue -->
<template>
  <div class="note-input-system">
    <!-- éŸ³ç¬¦è¼¸å…¥æ¨¡å¼é¸æ“‡ -->
    <div class="input-mode-selector">
      <button
        v-for="mode in inputModes"
        :key="mode.id"
        @click="activeInputMode = mode.id"
        class="mode-button"
        :class="{ 'mode-active': activeInputMode === mode.id }"
      >
        <component :is="mode.icon" class="w-4 h-4" />
        <span>{{ mode.name }}</span>
      </button>
    </div>
    
    <!-- éŸ³ç¬¦å±¬æ€§é¢æ¿ -->
    <div class="note-properties-panel">
      <!-- éŸ³ç¬¦æ™‚å€¼é¸æ“‡ -->
      <div class="property-group">
        <label class="property-label">æ™‚å€¼</label>
        <div class="duration-selector">
          <button
            v-for="duration in noteDurations"
            :key="duration.value"
            @click="selectedDuration = duration.value"
            class="duration-button"
            :class="{ 'duration-active': selectedDuration === duration.value }"
          >
            <span class="duration-symbol">{{ duration.symbol }}</span>
            <span class="duration-name">{{ duration.name }}</span>
          </button>
        </div>
      </div>
      
      <!-- éŸ³é«˜èª¿æ•´ -->
      <div class="property-group">
        <label class="property-label">éŸ³é«˜</label>
        <div class="pitch-controls">
          <button @click="adjustPitch(-1)" class="pitch-button">
            <ChevronDownIcon class="w-4 h-4" />
          </button>
          <div class="pitch-display">{{ currentPitch }}</div>
          <button @click="adjustPitch(1)" class="pitch-button">
            <ChevronUpIcon class="w-4 h-4" />
          </button>
        </div>
      </div>
      
      <!-- è‡¨æ™‚è¨˜è™Ÿ -->
      <div class="property-group">
        <label class="property-label">è‡¨æ™‚è¨˜è™Ÿ</label>
        <div class="accidental-selector">
          <button
            v-for="accidental in accidentals"
            :key="accidental.id"
            @click="selectedAccidental = accidental.id"
            class="accidental-button"
            :class="{ 'accidental-active': selectedAccidental === accidental.id }"
          >
            {{ accidental.symbol }}
          </button>
        </div>
      </div>
      
      <!-- è¡¨æƒ…è¨˜è™Ÿ -->
      <div class="property-group">
        <label class="property-label">è¡¨æƒ…</label>
        <div class="articulation-selector">
          <button
            v-for="articulation in articulations"
            :key="articulation.id"
            @click="toggleArticulation(articulation.id)"
            class="articulation-button"
            :class="{ 'articulation-active': selectedArticulations.includes(articulation.id) }"
          >
            {{ articulation.symbol }}
          </button>
        </div>
      </div>
    </div>
    
    <!-- å³æ™‚é è¦½ -->
    <div class="note-preview">
      <div class="preview-label">é è¦½</div>
      <div class="preview-staff">
        <svg class="preview-svg" viewBox="0 0 100 60">
          <!-- äº”ç·šè­œç·š -->
          <g class="staff-lines">
            <line v-for="i in 5" :key="i" 
                  :y1="i * 10 + 5" :y2="i * 10 + 5" 
                  x1="10" x2="90" 
                  stroke="currentColor" stroke-width="1"/>
          </g>
          
          <!-- é è¦½éŸ³ç¬¦ -->
          <g class="preview-note" transform="translate(50, 30)">
            <NoteSymbol
              :duration="selectedDuration"
              :pitch="currentPitch"
              :accidental="selectedAccidental"
              :articulations="selectedArticulations"
            />
          </g>
        </svg>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed } from 'vue'
import {
  CursorArrowRaysIcon,
  HandRaisedIcon,
  PencilIcon,
  ChevronUpIcon,
  ChevronDownIcon
} from '@heroicons/vue/24/outline'

const activeInputMode = ref('cursor')
const selectedDuration = ref('quarter')
const currentPitch = ref('C4')
const selectedAccidental = ref('')
const selectedArticulations = ref<string[]>([])

const inputModes = [
  { id: 'cursor', name: 'æ¸¸æ¨™', icon: CursorArrowRaysIcon },
  { id: 'click', name: 'é»æ“Š', icon: HandRaisedIcon },
  { id: 'draw', name: 'ç¹ªè£½', icon: PencilIcon }
]

const noteDurations = [
  { value: 'whole', symbol: 'ğ…', name: 'å…¨éŸ³ç¬¦' },
  { value: 'half', symbol: 'ğ…—ğ…¥', name: 'äºŒåˆ†éŸ³ç¬¦' },
  { value: 'quarter', symbol: 'â™©', name: 'å››åˆ†éŸ³ç¬¦' },
  { value: 'eighth', symbol: 'â™ª', name: 'å…«åˆ†éŸ³ç¬¦' },
  { value: 'sixteenth', symbol: 'ğ…˜ğ…¥ğ…¯', name: 'åå…­åˆ†éŸ³ç¬¦' }
]

const accidentals = [
  { id: 'sharp', symbol: 'â™¯' },
  { id: 'flat', symbol: 'â™­' },
  { id: 'natural', symbol: 'â™®' },
  { id: '', symbol: 'ç„¡' }
]

const articulations = [
  { id: 'staccato', symbol: '.' },
  { id: 'accent', symbol: '>' },
  { id: 'tenuto', symbol: '-' },
  { id: 'fermata', symbol: 'ğ„' }
]

const adjustPitch = (direction: number) => {
  // èª¿æ•´éŸ³é«˜é‚è¼¯
  const pitches = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B']
  const octaves = [0, 1, 2, 3, 4, 5, 6, 7, 8]
  
  const currentNote = currentPitch.value.slice(0, -1)
  const currentOctave = parseInt(currentPitch.value.slice(-1))
  const currentIndex = pitches.indexOf(currentNote)
  
  let newIndex = currentIndex + direction
  let newOctave = currentOctave
  
  if (newIndex >= pitches.length) {
    newIndex = 0
    newOctave += 1
  } else if (newIndex < 0) {
    newIndex = pitches.length - 1
    newOctave -= 1
  }
  
  newOctave = Math.max(0, Math.min(8, newOctave))
  currentPitch.value = pitches[newIndex] + newOctave
}

const toggleArticulation = (id: string) => {
  const index = selectedArticulations.value.indexOf(id)
  if (index > -1) {
    selectedArticulations.value.splice(index, 1)
  } else {
    selectedArticulations.value.push(id)
  }
}
</script>

<style scoped>
.note-input-system {
  @apply space-y-4 p-4;
  @apply bg-white dark:bg-gray-800;
  @apply border border-gray-200 dark:border-gray-700;
  @apply rounded-lg;
}

/* è¼¸å…¥æ¨¡å¼é¸æ“‡ */
.input-mode-selector {
  @apply flex space-x-2;
}

.mode-button {
  @apply flex items-center space-x-2;
  @apply px-3 py-2 rounded-md;
  @apply text-sm font-medium;
  @apply text-gray-600 dark:text-gray-300;
  @apply bg-gray-100 dark:bg-gray-700;
  @apply hover:bg-gray-200 dark:hover:bg-gray-600;
  @apply transition-colors duration-200;
  
  &.mode-active {
    @apply bg-blue-100 dark:bg-blue-900;
    @apply text-blue-600 dark:text-blue-400;
  }
}

/* å±¬æ€§é¢æ¿ */
.note-properties-panel {
  @apply space-y-4;
}

.property-group {
  @apply space-y-2;
}

.property-label {
  @apply block text-sm font-medium;
  @apply text-gray-700 dark:text-gray-300;
}

/* æ™‚å€¼é¸æ“‡å™¨ */
.duration-selector {
  @apply grid grid-cols-5 gap-2;
}

.duration-button {
  @apply flex flex-col items-center;
  @apply p-2 rounded-md;
  @apply bg-gray-50 dark:bg-gray-700;
  @apply hover:bg-gray-100 dark:hover:bg-gray-600;
  @apply transition-colors duration-200;
  
  &.duration-active {
    @apply bg-blue-100 dark:bg-blue-900;
    @apply text-blue-600 dark:text-blue-400;
  }
}

.duration-symbol {
  @apply text-xl font-bold mb-1;
}

.duration-name {
  @apply text-xs;
}

/* éŸ³é«˜æ§åˆ¶ */
.pitch-controls {
  @apply flex items-center space-x-2;
}

.pitch-button {
  @apply p-2 rounded-md;
  @apply bg-gray-100 dark:bg-gray-700;
  @apply hover:bg-gray-200 dark:hover:bg-gray-600;
  @apply transition-colors duration-200;
}

.pitch-display {
  @apply px-3 py-2;
  @apply bg-gray-50 dark:bg-gray-700;
  @apply border border-gray-300 dark:border-gray-600;
  @apply rounded-md;
  @apply text-center font-mono;
  @apply min-w-16;
}

/* è‡¨æ™‚è¨˜è™Ÿé¸æ“‡å™¨ */
.accidental-selector {
  @apply flex space-x-2;
}

.accidental-button {
  @apply flex items-center justify-center;
  @apply w-8 h-8 rounded-md;
  @apply bg-gray-100 dark:bg-gray-700;
  @apply hover:bg-gray-200 dark:hover:bg-gray-600;
  @apply text-lg font-bold;
  @apply transition-colors duration-200;
  
  &.accidental-active {
    @apply bg-blue-100 dark:bg-blue-900;
    @apply text-blue-600 dark:text-blue-400;
  }
}

/* è¡¨æƒ…è¨˜è™Ÿé¸æ“‡å™¨ */
.articulation-selector {
  @apply flex flex-wrap gap-2;
}

.articulation-button {
  @apply flex items-center justify-center;
  @apply w-8 h-8 rounded-md;
  @apply bg-gray-100 dark:bg-gray-700;
  @apply hover:bg-gray-200 dark:hover:bg-gray-600;
  @apply text-lg font-bold;
  @apply transition-colors duration-200;
  
  &.articulation-active {
    @apply bg-green-100 dark:bg-green-900;
    @apply text-green-600 dark:text-green-400;
  }
}

/* å³æ™‚é è¦½ */
.note-preview {
  @apply mt-4 p-4;
  @apply bg-gray-50 dark:bg-gray-700;
  @apply rounded-md;
}

.preview-label {
  @apply text-sm font-medium mb-2;
  @apply text-gray-700 dark:text-gray-300;
}

.preview-staff {
  @apply flex justify-center;
}

.preview-svg {
  @apply w-32 h-20;
  color: theme('colors.gray.700');
  
  .dark & {
    color: theme('colors.gray.300');
  }
}

.staff-lines line {
  opacity: 0.6;
}
</style>
```

---

## ğŸ›ï¸ å±¬æ€§é¢æ¿è¨­è¨ˆ

### å‹•æ…‹å±¬æ€§ç·¨è¼¯å™¨
```vue
<!-- components/editor/PropertiesPanel.vue -->
<template>
  <div class="properties-panel">
    <!-- é¢æ¿æ¨™é¡Œ -->
    <div class="panel-header">
      <h3 class="panel-title">å±¬æ€§</h3>
      <div v-if="selectedElements.length > 0" class="selection-info">
        å·²é¸å– {{ selectedElements.length }} å€‹å…ƒç´ 
      </div>
    </div>
    
    <!-- å±¬æ€§å…§å®¹ -->
    <div class="panel-content">
      <!-- ç„¡é¸å–ç‹€æ…‹ -->
      <div v-if="selectedElements.length === 0" class="no-selection">
        <div class="no-selection-icon">
          <CursorArrowRaysIcon class="w-12 h-12 text-gray-300" />
        </div>
        <p class="no-selection-text">è«‹é¸å–ä¸€å€‹æˆ–å¤šå€‹å…ƒç´ ä¾†ç·¨è¼¯å±¬æ€§</p>
      </div>
      
      <!-- å–®ä¸€å…ƒç´ å±¬æ€§ -->
      <div v-else-if="selectedElements.length === 1" class="single-element">
        <div class="element-type-badge">
          {{ getElementTypeName(selectedElements[0]) }}
        </div>
        
        <!-- éŸ³ç¬¦å±¬æ€§ -->
        <div v-if="selectedElements[0].type === 'note'" class="note-properties">
          <!-- åŸºæœ¬å±¬æ€§ -->
          <div class="property-section">
            <h4 class="section-title">åŸºæœ¬å±¬æ€§</h4>
            
            <div class="property-item">
              <label class="property-label">éŸ³é«˜</label>
              <PitchSelector
                v-model="selectedElements[0].pitch"
                @change="updateProperty('pitch', $event)"
              />
            </div>
            
            <div class="property-item">
              <label class="property-label">æ™‚å€¼</label>
              <DurationSelector
                v-model="selectedElements[0].duration"
                @change="updateProperty('duration', $event)"
              />
            </div>
            
            <div class="property-item">
              <label class="property-label">è‡¨æ™‚è¨˜è™Ÿ</label>
              <AccidentalSelector
                v-model="selectedElements[0].accidental"
                @change="updateProperty('accidental', $event)"
              />
            </div>
          </div>
          
          <!-- è¡¨æƒ…è¨˜è™Ÿ -->
          <div class="property-section">
            <h4 class="section-title">è¡¨æƒ…è¨˜è™Ÿ</h4>
            
            <div class="property-item">
              <label class="property-label">åŠ›åº¦</label>
              <DynamicSelector
                v-model="selectedElements[0].dynamic"
                @change="updateProperty('dynamic', $event)"
              />
            </div>
            
            <div class="property-item">
              <label class="property-label">å¥æ³•</label>
              <ArticulationSelector
                v-model="selectedElements[0].articulations"
                @change="updateProperty('articulations', $event)"
              />
            </div>
          </div>
          
          <!-- ä½ç½®èˆ‡å°é½Š -->
          <div class="property-section">
            <h4 class="section-title">ä½ç½®èˆ‡å°é½Š</h4>
            
            <div class="property-item">
              <label class="property-label">æ°´å¹³ä½ç½®</label>
              <div class="coordinate-input">
                <input
                  v-model.number="selectedElements[0].x"
                  @change="updateProperty('x', $event.target.value)"
                  type="number"
                  class="coordinate-field"
                />
                <span class="coordinate-unit">px</span>
              </div>
            </div>
            
            <div class="property-item">
              <label class="property-label">å‚ç›´ä½ç½®</label>
              <div class="coordinate-input">
                <input
                  v-model.number="selectedElements[0].y"
                  @change="updateProperty('y', $event.target.value)"
                  type="number"
                  class="coordinate-field"
                />
                <span class="coordinate-unit">px</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- ä¼‘æ­¢ç¬¦å±¬æ€§ -->
        <div v-else-if="selectedElements[0].type === 'rest'" class="rest-properties">
          <div class="property-section">
            <h4 class="section-title">ä¼‘æ­¢ç¬¦å±¬æ€§</h4>
            
            <div class="property-item">
              <label class="property-label">æ™‚å€¼</label>
              <DurationSelector
                v-model="selectedElements[0].duration"
                @change="updateProperty('duration', $event)"
              />
            </div>
          </div>
        </div>
        
        <!-- å…¶ä»–å…ƒç´ å±¬æ€§ -->
        <div v-else class="generic-properties">
          <div class="property-section">
            <h4 class="section-title">é€šç”¨å±¬æ€§</h4>
            
            <div class="property-item">
              <label class="property-label">é¡è‰²</label>
              <ColorPicker
                v-model="selectedElements[0].color"
                @change="updateProperty('color', $event)"
              />
            </div>
            
            <div class="property-item">
              <label class="property-label">é€æ˜åº¦</label>
              <div class="opacity-slider">
                <input
                  v-model.number="selectedElements[0].opacity"
                  @change="updateProperty('opacity', $event.target.value)"
                  type="range"
                  min="0"
                  max="1"
                  step="0.1"
                  class="slider"
                />
                <span class="opacity-value">{{ Math.round(selectedElements[0].opacity * 100) }}%</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- å¤šå…ƒç´ å±¬æ€§ -->
      <div v-else class="multiple-elements">
        <div class="element-type-badge">
          {{ selectedElements.length }} å€‹å…ƒç´ 
        </div>
        
        <!-- æ‰¹é‡æ“ä½œ -->
        <div class="property-section">
          <h4 class="section-title">æ‰¹é‡æ“ä½œ</h4>
          
          <div class="batch-actions">
            <button @click="alignElements('left')" class="batch-action-btn">
              <AlignLeft class="w-4 h-4" />
              å·¦å°é½Š
            </button>
            
            <button @click="alignElements('center')" class="batch-action-btn">
              <AlignCenter class="w-4 h-4" />
              æ°´å¹³å±…ä¸­
            </button>
            
            <button @click="alignElements('right')" class="batch-action-btn">
              <AlignRight class="w-4 h-4" />
              å³å°é½Š
            </button>
          </div>
          
          <div class="batch-actions">
            <button @click="distributeElements('horizontal')" class="batch-action-btn">
              <DistributeHorizontal class="w-4 h-4" />
              æ°´å¹³åˆ†ä½ˆ
            </button>
            
            <button @click="distributeElements('vertical')" class="batch-action-btn">
              <DistributeVertical class="w-4 h-4" />
              å‚ç›´åˆ†ä½ˆ
            </button>
          </div>
        </div>
        
        <!-- å…±åŒå±¬æ€§ -->
        <div class="property-section">
          <h4 class="section-title">å…±åŒå±¬æ€§</h4>
          
          <div v-for="commonProperty in commonProperties" :key="commonProperty.key">
            <div class="property-item">
              <label class="property-label">{{ commonProperty.label }}</label>
              <component
                :is="commonProperty.component"
                :model-value="commonProperty.value"
                @change="updateMultipleProperties(commonProperty.key, $event)"
              />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed } from 'vue'
import { CursorArrowRaysIcon } from '@heroicons/vue/24/outline'

interface Props {
  selectedElements: any[]
}

const props = defineProps<Props>()

const emit = defineEmits<{
  'property-change': [elementId: string, property: string, value: any]
  'batch-property-change': [elementIds: string[], property: string, value: any]
}>()

// è¨ˆç®—å…±åŒå±¬æ€§
const commonProperties = computed(() => {
  if (props.selectedElements.length === 0) return []
  
  const commonProps = []
  const firstElement = props.selectedElements[0]
  
  // æª¢æŸ¥æ‰€æœ‰é¸å–å…ƒç´ éƒ½æœ‰çš„å±¬æ€§
  for (const [key, value] of Object.entries(firstElement)) {
    if (props.selectedElements.every(el => el.hasOwnProperty(key))) {
      // æª¢æŸ¥æ˜¯å¦æ‰€æœ‰å…ƒç´ çš„é€™å€‹å±¬æ€§å€¼éƒ½ç›¸åŒ
      const allSameValue = props.selectedElements.every(el => el[key] === value)
      
      commonProps.push({
        key,
        label: getPropertyLabel(key),
        component: getPropertyComponent(key),
        value: allSameValue ? value : '(æ··åˆ)',
        mixed: !allSameValue
      })
    }
  }
  
  return commonProps
})

const getElementTypeName = (element: any): string => {
  const typeNames: { [key: string]: string } = {
    note: 'éŸ³ç¬¦',
    rest: 'ä¼‘æ­¢ç¬¦',
    clef: 'è­œè™Ÿ',
    key: 'èª¿è™Ÿ',
    time: 'æ‹è™Ÿ'
  }
  return typeNames[element.type] || element.type
}

const getPropertyLabel = (key: string): string => {
  const labels: { [key: string]: string } = {
    pitch: 'éŸ³é«˜',
    duration: 'æ™‚å€¼',
    accidental: 'è‡¨æ™‚è¨˜è™Ÿ',
    color: 'é¡è‰²',
    opacity: 'é€æ˜åº¦',
    x: 'æ°´å¹³ä½ç½®',
    y: 'å‚ç›´ä½ç½®'
  }
  return labels[key] || key
}

const getPropertyComponent = (key: string): string => {
  const components: { [key: string]: string } = {
    pitch: 'PitchSelector',
    duration: 'DurationSelector',
    accidental: 'AccidentalSelector',
    color: 'ColorPicker',
    opacity: 'OpacitySlider'
  }
  return components[key] || 'input'
}

const updateProperty = (property: string, value: any) => {
  if (props.selectedElements.length === 1) {
    const element = props.selectedElements[0]
    emit('property-change', element.id, property, value)
  }
}

const updateMultipleProperties = (property: string, value: any) => {
  const elementIds = props.selectedElements.map(el => el.id)
  emit('batch-property-change', elementIds, property, value)
}

const alignElements = (alignment: 'left' | 'center' | 'right') => {
  console.log('Align elements:', alignment)
}

const distributeElements = (direction: 'horizontal' | 'vertical') => {
  console.log('Distribute elements:', direction)
}
</script>

<style scoped>
.properties-panel {
  @apply h-full flex flex-col;
  @apply bg-white dark:bg-gray-800;
}

.panel-header {
  @apply p-4 border-b border-gray-200 dark:border-gray-700;
  @apply flex-shrink-0;
}

.panel-title {
  @apply text-lg font-semibold;
  @apply text-gray-900 dark:text-white;
}

.selection-info {
  @apply text-sm text-gray-600 dark:text-gray-400;
  @apply mt-1;
}

.panel-content {
  @apply flex-1 overflow-y-auto;
  @apply p-4 space-y-6;
}

/* ç„¡é¸å–ç‹€æ…‹ */
.no-selection {
  @apply text-center py-8;
}

.no-selection-icon {
  @apply mb-4;
}

.no-selection-text {
  @apply text-gray-500 dark:text-gray-400;
  @apply text-sm;
}

/* å…ƒç´ é¡å‹æ¨™è¨˜ */
.element-type-badge {
  @apply inline-block px-3 py-1;
  @apply bg-blue-100 dark:bg-blue-900;
  @apply text-blue-800 dark:text-blue-200;
  @apply text-sm font-medium rounded-full;
  @apply mb-4;
}

/* å±¬æ€§å€æ®µ */
.property-section {
  @apply space-y-4;
}

.section-title {
  @apply text-sm font-semibold;
  @apply text-gray-700 dark:text-gray-300;
  @apply border-b border-gray-200 dark:border-gray-700;
  @apply pb-2;
}

/* å±¬æ€§é …ç›® */
.property-item {
  @apply space-y-2;
}

.property-label {
  @apply block text-sm font-medium;
  @apply text-gray-600 dark:text-gray-400;
}

/* åº§æ¨™è¼¸å…¥ */
.coordinate-input {
  @apply flex items-center space-x-2;
}

.coordinate-field {
  @apply flex-1 px-3 py-2;
  @apply bg-gray-50 dark:bg-gray-700;
  @apply border border-gray-300 dark:border-gray-600;
  @apply rounded-md;
  @apply text-sm;
}

.coordinate-unit {
  @apply text-sm text-gray-500 dark:text-gray-400;
}

/* é€æ˜åº¦æ»‘æ¡¿ */
.opacity-slider {
  @apply flex items-center space-x-3;
}

.slider {
  @apply flex-1 h-2;
  @apply bg-gray-200 dark:bg-gray-600;
  @apply rounded-lg appearance-none;
  @apply cursor-pointer;
}

.opacity-value {
  @apply text-sm font-medium;
  @apply text-gray-600 dark:text-gray-400;
  @apply min-w-12 text-right;
}

/* æ‰¹é‡æ“ä½œ */
.batch-actions {
  @apply grid grid-cols-3 gap-2;
  @apply mb-4;
}

.batch-action-btn {
  @apply flex flex-col items-center;
  @apply p-3 rounded-md;
  @apply text-xs font-medium;
  @apply text-gray-600 dark:text-gray-300;
  @apply bg-gray-100 dark:bg-gray-700;
  @apply hover:bg-gray-200 dark:hover:bg-gray-600;
  @apply transition-colors duration-200;
}
</style>
```

---

## âœ… æœ¬æ–‡ä»¶åŒ…å«å…§å®¹

1. **ç·¨è¼¯å™¨æ ¸å¿ƒæ¶æ§‹** - å››å±¤ç•Œé¢å±¤æ¬¡çµæ§‹å’ŒéŸ³æ¨‚å…ƒç´ çµ„ç¹”
2. **å·¥å…·é¢æ¿è¨­è¨ˆ** - åˆ†é¡å·¥å…·é¸ç›¤ï¼ŒåŒ…å«éŸ³ç¬¦ã€ä¼‘æ­¢ç¬¦ã€ç¬¦è™Ÿã€è¡¨æƒ…è¨˜è™Ÿ
3. **æ¨‚è­œç•«å¸ƒè¨­è¨ˆ** - SVG ç•«å¸ƒæ¶æ§‹ï¼Œæ”¯æ´ç¸®æ”¾ã€é¸å–ã€å”ä½œæ¸¸æ¨™
4. **éŸ³ç¬¦ç·¨è¼¯çµ„ä»¶** - æ™ºèƒ½éŸ³ç¬¦è¼¸å…¥ç³»çµ±ï¼Œå³æ™‚é è¦½åŠŸèƒ½
5. **å±¬æ€§é¢æ¿è¨­è¨ˆ** - å‹•æ…‹å±¬æ€§ç·¨è¼¯å™¨ï¼Œæ”¯æ´å–®ä¸€èˆ‡æ‰¹é‡ç·¨è¼¯

## ğŸ”— ç›¸é—œæ–‡ä»¶

ğŸ‘‰ **ä¸‹ä¸€æ­¥ï¼šåƒè€ƒ [07_æ¨‚åº«èˆ‡å”ä½œç•Œé¢.md](./07_æ¨‚åº«èˆ‡å”ä½œç•Œé¢.md) äº†è§£æ¨‚åº«å’Œå”ä½œç•Œé¢è¨­è¨ˆ**

ğŸ‘‰ **ä¸¦è¡Œï¼šåƒè€ƒ [08_ç”¨æˆ¶ç³»çµ±ç•Œé¢.md](./08_ç”¨æˆ¶ç³»çµ±ç•Œé¢.md) äº†è§£ç”¨æˆ¶ç³»çµ±å’Œè¨­å®šç•Œé¢**
